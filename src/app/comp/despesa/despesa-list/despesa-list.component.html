<p class="title-bar-1">Despesas</p>
<!-- <div class="table">
    <div class="row">
        <div class="cell">Tipo Despesa: </div>
        <div class="cell">
            <p-dropdown [options]="tiposDespesa" optionLabel="nome" optionValue="value" 
            [style]="{'width':'200px'}">
            </p-dropdown>
        </div>
    </div>
</div> -->

<p-table [value]="despesas" 
    [loading]="loading" 
    [lazy]="true" 
    (onLazyLoad)="loadData($event)"
    [rowsPerPageOptions]="[10,15,20,25,30,40]" 
    [alwaysShowPaginator]="true" 
    [paginator]="true"
    [showCurrentPageReport]="true" 
    [totalRecords]="totalElements" 
    [rows]="pageSize" 
    [sortOrder]="-1"
    sortField="data"
    currentPageReportTemplate="Mostrando {first} a {last} de {{totalElements}} despesas" 
    dataKey="id" #dt
    selectionMode="single" 
    styleClass="p-datatable-striped p-datatable-sm"
    [(contextMenuSelection)]="despesaSelecionada">
    <ng-template pTemplate="header">
        <tr>
            <th></th>
            <th pSortableColumn="id" class="columnId">Id
                <p-sortIcon field="id"></p-sortIcon>
            </th>
            <th pSortableColumn="tipoDespesa">Tipo Despesa
                <p-sortIcon field="tipoDespesa"></p-sortIcon>
            </th>
            <th pSortableColumn="data"class="columnDate">Data
                <p-sortIcon field="data"></p-sortIcon>
            </th>
            <th pSortableColumn="fornecedor.nome">Fornecedor
                <p-sortIcon field="fornecedor.nome"></p-sortIcon>
            </th>
            <th pSortableColumn="formaPagamento">Forma pagamento
                <p-sortIcon field="formaPagamento"></p-sortIcon>
            </th>
            <th>Valor</th>
        </tr>
        <tr>
            <th></th>
            <th class="columnId">
                <p-columnFilter field="id"
                        [showMenu]="false" 
                        [showClearButton]="false">
                        <ng-template pTemplate="filter" let-filter="filterCallback">
                            <p-inputNumber mode="decimal" inputId="withoutgrouping" 
                            (onInput)="filter($event.value)"
                            [useGrouping]="false">
                        </p-inputNumber>
                        </ng-template>
                </p-columnFilter>
            </th>
            <th>
                <p-columnFilter field="tipoDespesa"
                    [showMenu]="false" 
                    [showClearButton]="false">
                    <ng-template pTemplate="filter" let-filter="filterCallback">
                        <p-dropdown [options]="tiposDespesa" placeholder="todos" 
                            (onChange)="filter($event.value)"
                            [showClear]="true"
                            optionLabel="nome" 
                            optionValue="value">
                        </p-dropdown>
                    </ng-template>
                </p-columnFilter>
            </th>
            <th class="columnDate">
                <p-columnFilter field="periodo"
                [showMenu]="false" 
                [showClearButton]="false">
                    <ng-template pTemplate="filter" let-filter="filterCallback">
                        <p-calendar selectionMode="range" [readonlyInput]="true" 
                            [showButtonBar]="true"
                            rangeSeparator="atÃ©"
                            appendTo="body"
                            inputId="range"
                            [panelStyle]="{'width':'788'}"
                            dateFormat="dd/mm/yy"
                            dataType="string"
                            #periodoDatas
                            (onSelect)="filter(periodoDatas.value)">
                        </p-calendar>
                    </ng-template>
                </p-columnFilter>
            </th>
            <th>
                <p-columnFilter field="fornecedor.id"
                [showMenu]="false" 
                [showClearButton]="false">
                    <ng-template pTemplate="filter" let-filter="filterCallback">
                        <p-dropdown [options]="fornecedores" placeholder="todos"
                            [filter]="true" 
                            filterBy="nome" 
                            [showClear]="true" 
                            (onChange)="filter($event.value)"
                            [showClear]="true"
                            optionLabel="nome" 
                            optionValue="id">
                        </p-dropdown>
                    </ng-template>
                </p-columnFilter>
            </th>
            <th>
                <p-columnFilter field="formaPagamento"
                [showMenu]="false" 
                [showClearButton]="false">
                <ng-template pTemplate="filter" let-filter="filterCallback">
                    <p-dropdown [options]="formasPagamento" placeholder="todos" 
                        (onChange)="filter($event.value)"
                        [showClear]="true"
                        optionLabel="nome" 
                        optionValue="value">
                    </p-dropdown>
                </ng-template>
            </p-columnFilter>
            </th>
            <th></th>
        </tr>
    </ng-template>
    <ng-template pTemplate="body" let-despesa let-expanded="expanded">
        <tr>
            <td>
                <button type="button" pButton pRipple [pRowToggler]="despesa" 
                class="p-button-text p-button-rounded p-button-plain p-button-sm" 
                [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"
                style="width: 5px; height: 5px;">
                </button>
            </td>
            <td class="columnId">{{despesa.id}}</td>
            <td>{{despesa.tipoDespesa.nome}}</td>
            <td class="columnDate">{{despesa.data | date:'dd/MM/yyyy'}}</td>
            <td>{{despesa.fornecedor.nome}}</td>
            <td>{{despesa.formaPagamento.nome}}</td>
            <td style="text-align: right;">{{despesa.valor | currency:'BRL'}}</td>
        </tr>
    </ng-template>
    <ng-template pTemplate="rowexpansion" let-product>
        <tr>
            <td colspan="6">
                tasdfa ....
            </td>
        </tr>
    </ng-template>
    <ng-template pTemplate="footer">
        <tr>
            <td [attr.colspan]="6" style='text-align: right;'>Total:</td>
            <td style="text-align: right;">{{totalValor | number : '1.2-2' }}</td>
        </tr>
    </ng-template>
</p-table>