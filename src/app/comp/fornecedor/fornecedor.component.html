<p class="title-bar-1">Fornecedor</p>
<p-toast></p-toast>
<p-tabView [activeIndex]="tabSelected" (onChange)="changeTab($event)">
    <p-tabPanel header="Consulta">
        <p-table [value]="fornecedores" 
            [loading]="loading" 
            [lazy]="true" 
            (onLazyLoad)="loadData($event)"
            [rowsPerPageOptions]="[10,15,20,25,30,40]" 
            [alwaysShowPaginator]="true" 
            [paginator]="true"
            [showCurrentPageReport]="true" 
            [totalRecords]="totalElements" 
            [rows]="pageSize" 
            [sortOrder]="-1"
            sortField="nome"
            currentPageReportTemplate="Mostrando {first} a {last} de {{totalElements}} despesas" 
            dataKey="id" #dt
            selectionMode="single"
            styleClass="p-datatable-striped p-datatable-sm"
            [(contextMenuSelection)]="fornecedorSelecionado">
            <ng-template pTemplate="header">
                <tr>
                    <th class="columnExpand"></th>
                    <th pSortableColumn="id" class="columnId">Id
                        <p-sortIcon field="id"></p-sortIcon>
                    </th>
                    <th pSortableColumn="nome">Nome
                        <p-sortIcon field="nome"></p-sortIcon>
                    </th>
                    <th pSortableColumn="cnpj">CNPJ
                        <p-sortIcon field="cnpj"></p-sortIcon>
                    </th>
                    <th pSortableColumn="cidade">Cidade
                        <p-sortIcon field="cidade"></p-sortIcon>
                    </th>
                    <th class="columnActionBt">Editar</th>
                </tr>
                <tr>
                    <th class="columnExpand"></th>
                    <th class="columnId">
                        <p-columnFilter field="id"
                                [showMenu]="false" 
                                [showClearButton]="false">
                                <ng-template pTemplate="filter" let-filter="filterCallback">
                                    <p-inputNumber mode="decimal" inputId="withoutgrouping" 
                                    (onInput)="filter($event.value)"
                                    [useGrouping]="false">
                                </p-inputNumber>
                                </ng-template>
                        </p-columnFilter>
                    </th>
                    <th>
                        <p-columnFilter field="nome" 
                                (input)="dt.filterGlobal($event.target.value, 'contains')"
                                [showMenu]="false" 
                                [showClearButton]="false">
                        </p-columnFilter>
                    </th>
                    <th>
                        <p-columnFilter field="cnpj" 
                                (input)="dt.filterGlobal($event.target.value, 'contains')"
                                [showMenu]="false" 
                                [showClearButton]="false">
                        </p-columnFilter>
                    </th>
                    <th>
                        <p-columnFilter field="cidade.nome" 
                                (input)="dt.filterGlobal($event.target.value, 'contains')"
                                [showMenu]="false" 
                                [showClearButton]="false">
                        </p-columnFilter>
                    </th>
                    <th class="columnActionBt"></th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-fornecedor let-expanded="expanded" let-ri="rowIndex">
                <tr>
                    <td class="columnExpand">
                        <button type="button" pButton pRipple [pRowToggler]="fornecedor"
                        class="p-button-text p-button-rounded p-button-plain p-button-sm smallBt" 
                        [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'">
                        </button>
                    </td>
                    <td class="columnId">{{fornecedor.id}}</td>
                    <td>{{fornecedor.nome}}</td>
                    <td>{{fornecedor.cnpj | cnpj}}</td>
                    <td>{{fornecedor.cidade.nome}}</td>
                    <td class="columnActionBt">
                        <button pButton pRipple type="button" icon="pi pi-pencil" 
                            (click)="onEditSave(fornecedor)"
                            class="p-button-rounded p-button-text p-button-sm smallBt">
                        </button>
                    </td>
                </tr>
            </ng-template>
            <ng-template pTemplate="rowexpansion" let-fornecedor>
                <tr>
                    <td></td>
                    <td></td>
                    <td>
                        <div class="table">
                            <div class="row">
                                <div class="cell">Razão Social: </div>
                                <div class="cell">{{fornecedor.razaoSocial}}</div>
                            </div>
                            <div class="row">
                                <div class="cell">CNPJ: </div>
                                <div class="cell">{{fornecedor.cnpj}}</div>
                                <div class="cell">Inscrição Estadual: </div>
                                <div class="cell">{{fornecedor.inscricaoEstadual}}</div>
                            </div>
                            <div class="row">
                                <div class="cell">Endereço: </div>
                                <div class="cell">{{fornecedor.endereco}}</div>
                                <div class="cell">Bairro: </div>
                                <div class="cell">{{fornecedor.bairro}}</div>
                            </div>
                            <div class="row">
                                <div class="cell">Cidade: </div>
                                <div class="cell">{{fornecedor.cidade.nome}} - {{fornecedor.cidade.estado.nome}}</div>
                                <div class="cell">Cep: </div>
                                <div class="cell">{{fornecedor.cep}}</div>
                            </div>
                            <div class="row">
                                <div class="cell">Complemento: </div>
                                <div class="cell">{{fornecedor.complemento}}</div>
                            </div>
                            <div class="row">
                                <div class="cell">Telefone: </div>
                                <div class="cell">{{fornecedor.telefone | telefone}}</div>
                            </div>
                        </div>
                    </td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
            </ng-template>
        </p-table>
    </p-tabPanel>
    <p-tabPanel header="Cadastro">
        <form [formGroup]="fornecedorForm" (ngSubmit)="onSubmit(fornecedorForm.value, dt)">

            <div class="table">
                <div class="row">
                    <div class="cell">CNPJ:</div>
                    <div class="cell">
                        <p-inputMask mask="99.999.999/9999-99" 
                        [(ngModel)]="fornecedorCadastro.cnpj"
                         formControlName="inputCNPJ" 
                         [style]="{'width': '200px'}">
                        </p-inputMask>
                        <p-button icon="pi pi-globe" [disabled]="fornecedorCadastro.cnpj==null"
                                [style]="{'margin-left':'.25em'}"
                                (onClick)="searchCNPJ($event)">
                        </p-button>
                    </div>
                    <div class="cell">
                        
                    </div>
                </div>
                <div class="row">
                    <div class="cell">Nome:</div>
                    <div class="cell">
                        <input type="text" pInputText 
                        [(ngModel)]="fornecedorCadastro.nome" 
                        formControlName="inputNome"
                        [style]="{'width': '450px'}"/>
                    </div>
                </div>
                <div class="row">
                    <div class="cell">Razão Social:</div>
                    <div class="cell">
                        <input type="text" pInputText 
                        [(ngModel)]="fornecedorCadastro.razaoSocial" 
                        formControlName="inputRazao"
                        [style]="{'width': '100%'}"/>
                    </div>
                </div>
                <div class="row">
                    <div class="cell">Insc. Estadual:</div>
                    <div class="cell">
                        <input type="text" pInputText 
                        [(ngModel)]="fornecedorCadastro.inscricaoEstadual"
                        formControlName="inputInscEstadual" 
                        [style]="{'width': '50%'}"/>
                    </div>
                </div>
                <div class="row">
                    <div class="cell">Endereço:</div>
                    <div class="cell">
                        <input type="text" pInputText 
                        [(ngModel)]="fornecedorCadastro.endereco" 
                        formControlName="inputEndereco"
                        [style]="{'width': '100%'}"/>
                    </div>
                </div>
                <div class="row">
                    <div class="cell">Complemento:</div>
                    <div class="cell">
                        <input type="text" pInputText 
                        [(ngModel)]="fornecedorCadastro.complemento" 
                        formControlName="inputEndereco"
                        [style]="{'width': '100%'}"/>
                    </div>
                </div>
                <div class="row">
                    <div class="cell">Cep:</div>
                    <div class="cell">
                        <p-inputMask mask="99999-999" 
                        [(ngModel)]="fornecedorCadastro.cep" 
                        formControlName="inputCep"
                        [style]="{'width': '30%'}">
                        </p-inputMask>
                    </div>
                </div>
                <div class="row">
                    <div class="cell">Telefone:</div>
                    <div class="cell">
                        <p-inputMask mask="99.99999-9999" 
                        [(ngModel)]="fornecedorCadastro.telefone"
                        formControlName="inputTelefone" 
                        [style]="{'width': '50%'}">
                        </p-inputMask>
                    </div>
                </div>
                <div class="row">
                    <div class="cell">Cidade:</div>
                    <div class="cell">
                        <p-autoComplete
                        [suggestions]="cidades"
                        formControlName="comboCidade"
                        (completeMethod)="filterCidade($event)"
                        [(ngModel)]="fornecedorCadastro.cidade"
                        field="nome"
                        [inputStyle]="{'width': '100%'}"
                        [panelStyle]="{'width': '290px'}"
                        scrollHeight="400px"
                        [style]="{'width': '98%'}"
                        [minLength]="1">
                          <ng-template let-value pTemplate="selectedItem">
                            <span>>{{value}}</span>
                          </ng-template>
                          <ng-template let-cid pTemplate="item">
                            <span  style="font-size:12px;" >{{cid.nome}}</span>
                            <span style="float: right;">{{cid.estado.nome}}</span>
                          </ng-template>
                        </p-autoComplete>
                    </div>
                </div>
                <div class="row">
                    <div class="cell"></div>
                    <div class="cell centerText">
                        <button icon="pi pi-save" pButton type="button" label="Salvar"
                        class="ui-button-raised ui-button-success"
                        [disabled]="!fornecedorForm.valid" type="submit">
                    </button>
                    </div>
                </div>
            </div>
        </form>
    </p-tabPanel>
</p-tabView>
<p-progressBar *ngIf="loading" mode="indeterminate" [style]="{'height': '6px'}"></p-progressBar>
{{fornecedorCadastro | json}}