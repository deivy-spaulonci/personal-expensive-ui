<p class="title-bar-1">Contas</p>
<p-toast></p-toast>
<p-tabView [activeIndex]="tabSelected" (onChange)="changeTab($event)">
    <p-tabPanel header="Consulta">
        <p-table [value]="contas" 
        [loading]="loading" 
        [lazy]="true" 
        (onLazyLoad)="loadData($event)"
        [rowsPerPageOptions]="[10,15,20,25,30,40]" 
        [alwaysShowPaginator]="true" 
        [paginator]="true"
        [showCurrentPageReport]="true" 
        [totalRecords]="totalElements" 
        [rows]="pageSize" 
        [sortOrder]="-1"
        sortField="vencimento"
        currentPageReportTemplate="Mostrando {first} a {last} de {{totalElements}} despesas" 
        dataKey="id" #dt
        selectionMode="single" W
        styleClass="p-datatable-striped p-datatable-sm"
        [(contextMenuSelection)]="contaSelecionada">
        <ng-template pTemplate="header">
            <tr>
                <th pSortableColumn="id" class="columnId">Id
                    <p-sortIcon field="id"></p-sortIcon>
                </th>
                <th pSortableColumn="tipoDespesa">Tipo Despesa
                    <p-sortIcon field="tipoDespesa"></p-sortIcon>
                </th>
                <th pSortableColumn="emissao" class="columnDate">Emissão
                    <p-sortIcon field="emissao"></p-sortIcon>
                </th>
                <th pSortableColumn="vencimento" class="columnDate">Vencimento
                    <p-sortIcon field="vencimento"></p-sortIcon>
                </th>
                <th pSortableColumn="parcela" class="centerText">Parcelas
                    <p-sortIcon field="parcela"></p-sortIcon>
                </th>
                <th>Valor</th>
                <th class="centerText">Status</th>
                <th class="columnActionBt">Editar</th>
                <th class="columnActionBt">Excluir</th>
            </tr>
            <tr>
                <th class="columnId">
                    <p-columnFilter field="id"
                            [showMenu]="false" 
                            [showClearButton]="false">
                        <ng-template pTemplate="filter" let-filter="filterCallback">
                            <p-inputNumber mode="decimal" inputId="withoutgrouping" 
                            (onInput)="filter($event.value)"
                            [useGrouping]="false">
                        </p-inputNumber>
                        </ng-template>
                    </p-columnFilter>
                </th>
                <th>
                    <p-columnFilter field="tipoConta"
                        [showMenu]="false" 
                        [showClearButton]="false">
                        <ng-template pTemplate="filter" let-filter="filterCallback">
                            <p-dropdown [options]="tiposConta" 
                                optionLabel="nome"
                                placeholder="todos" 
                                (onChange)="$event.value ? filter($event.value) : filter($event.value)"
                                [showClear]="true"
                                [resetFilterOnHide]="true">
                            </p-dropdown>
                        </ng-template>
                    </p-columnFilter>
                </th>
                <th>
                    <p-columnFilter field="periodoVencimento"
                    [showMenu]="false" 
                    [showClearButton]="false">
                        <ng-template pTemplate="filter" let-filter="filterCallback">
                            <p-calendar selectionMode="range" [readonlyInput]="true" 
                                [showButtonBar]="true"
                                rangeSeparator="até"
                                appendTo="body"
                                inputId="range"
                                [panelStyle]="{'width':'788'}"
                                dateFormat="dd/mm/yy"                                    
                                #periodoVencimentos
                                (onSelect)="filter(periodoVencimentos.value)">
                            </p-calendar>
                        </ng-template>
                    </p-columnFilter>
                </th>
                <th>
                    <p-columnFilter field="periodoEmissao"
                    [showMenu]="false" 
                    [showClearButton]="false">
                        <ng-template pTemplate="filter" let-filter="filterCallback">
                            <p-calendar selectionMode="range" [readonlyInput]="true" 
                                [showButtonBar]="true"
                                rangeSeparator="até"
                                appendTo="body"
                                inputId="range"
                                [panelStyle]="{'width':'788'}"
                                dateFormat="dd/mm/yy"                                    
                                #periodoEmissoes
                                (onSelect)="filter(periodoEmissoes.value)">
                            </p-calendar>
                        </ng-template>
                    </p-columnFilter>
                </th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-conta let-expanded="expanded" let-ri="rowIndex">
            <tr >
                <td class="columnId">{{conta.id}}</td>
                <td>{{conta.tipoConta.nome}}</td>
                <td class="columnDate">
                    {{conta.emissao | date: 'dd/MM/yyyy'}}
                </td>
                <td class="columnDate">
                    {{conta.vencimento | date: 'dd/MM/yyyy'}}
                </td>
                <td class="centerText">{{conta.parcela}}/{{conta.totalParcela}}</td>
                <td class="columnValor">{{conta.valor | currency:'BRL':true:'1.2-2'}}</td>
                <td class="centerText">
                    
                        <p-message severity="info" text="{{conta.status}}" *ngIf="conta.intStatus==1"></p-message>
                        <p-message severity="warn" text="{{conta.status}}" *ngIf="conta.intStatus==0"></p-message>
                        <p-message severity="error" text="{{conta.status}}" *ngIf="conta.intStatus==-1"></p-message>
                        <p-message severity="success" text="{{conta.status}}" *ngIf="conta.intStatus==2"></p-message>
                        <p-message severity="custom" text="{{conta.status}}" *ngIf="conta.intStatus==3" icon="pi-file"></p-message>                        
                    
                </td>
                <td class="columnActionBt">
                    <button pButton pRipple type="button" icon="pi pi-pencil" 
                        (onClick)="onEditSave(conta)"
                        class="p-button-rounded p-button-text p-button-sm smallBt">
                    </button>
                </td>
                <td class="columnActionBt">
                    <button pButton pRipple type="button" icon="pi pi-trash"
                        (onClick)="excluirConta()"
                        class="p-button-rounded p-button-text p-button-sm p-button-danger smallBt">
                    </button>
                </td>
            </tr>
        </ng-template>
    </p-table>
    </p-tabPanel>
    <p-tabPanel header="Cadastro"></p-tabPanel>
</p-tabView>